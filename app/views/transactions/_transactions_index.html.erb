<%= render 'shared/panel', locals: {
  title: "My Transactions",
  subtitle: "Your transaction history",
  header_actions: [],
  footer: true,
  objects: { title: "transaction", objects: @transactions } ,
  footer_actions: [
    { html: -> { link_to "#", class: "btn btn-nav me-2 active" do
        content_tag(:i, "", class: "fa-solid fa-file-pdf")
      end }
    },
    { html: -> { link_to "#", class: "btn btn-nav me-2 active" do
        content_tag(:i, "", class: "fa-solid fa-file-csv")
      end }
    }
  ]
  } do %>

    <div class="panel-body">
      <% if @transactions.blank? %>
        <div class="text-center py-5">
          <i class="bi bi-arrow-left-right text-muted" style="font-size: 3rem;"></i>
          <h3 class="mt-3">No Transactions Yet</h3>
          <p class="text-muted">Get started by creating your first transaction</p>
          <%= link_to "#",
            class: "btn btn-highlight",
            data: { bs_toggle: "modal", bs_target: "#newTransactionModal" } do %>
              <i class="fa-solid fa-plus"></i>
          <% end %>
        </div>
      <% else %>
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead>
              <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Coin</th>
                <th>Wallet</th>
                <th>Quantity</th>
                <th>Price</th>
                <th>Total</th>
                <th>Realised Profit</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>

              <% @transactions.order(date: :desc).each do |tx| %>
                <tr class="datarow m-2">
                  <td><%= tx.date.to_formatted_s(:short) %></td>
                  <td>
                    <span class="badge bg-<%= tx.buy? ? 'buy' : 'sell' %>">
                      <%= tx.transaction_type.capitalize %>
                    </span>
                  </td>
                  <td>
                    <%= image_tag tx.coin.logo_url, class: "img-thumbnail rounded-circle me-1", style: "width: 24px; height: 24px;" %>
                    <%= tx.coin.symbol %>
                  </td>
                  <td><%= tx.wallet.name %></td>
                  <td><%= tx.quantity %></td>
                  <td>$<%= number_with_precision(tx.price_per_coin, precision: 2) %></td>
                  <td>$<%= number_with_precision(tx.total_value, precision: 2) %></td>
                  <td><%= tx.realised_profit ? "$#{number_with_precision(tx.realised_profit, precision: 2)}" : "" %></td>
                  <td>
                    <div class="btn-group btn-group-sm" role="group">
                      <%= button_to transaction_path(tx), method: :delete,
                                   form: { class: "d-inline" },
                                   data: { turbo_confirm: "Are you sure you want to delete this transaction?" },
                                   class: "btn btn-outline-danger" do %>
                        <i class="bi bi-trash"></i>
                      <% end %>
                    </div>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% end %>
    </div>


<div class="compact-transactions mt-2">
  <% @transactions.order(date: :desc).each do |tx| %>
    <div class="tx-row p-3 rounded-5 mb-1">
      <div class="row g-2 d-flex justify-content-between align-items-center">
        <div class="col-md-1 text-nowrap" data-label="Date"><%= tx.date.to_formatted_s(:short) %></div>
        <div class="col-md-1 text-nowrap" data-label="Type">
          <span class="badge bg-<%= tx.buy? ? 'success' : 'danger' %> opacity-75">
            <%= tx.transaction_type.capitalize %>
          </span>
        </div>
        <div class="col-md-2 text-nowrap" data-label="Coin">
          <%= image_tag tx.coin.logo_url, class: "rounded-circle me-1", style: "width: 18px; height: 18px;" %>
          <%= tx.coin.symbol %>
        </div>
        <div class="col-md-2 text-nowrap" data-label="Wallet"><%= tx.wallet.name %></div>
        <div class="col-md-1 text-nowrap" data-label="Quantity"><%= tx.quantity %></div>
        <div class="col-md-1 text-nowrap" data-label="Price">$<%= number_with_precision(tx.price_per_coin, precision: 2) %></div>
        <div class="col-md-2 text-nowrap" data-label="Total">$<%= number_with_precision(tx.total_value, precision: 2) %></div>
        <div class="col-md-2 text-nowrap" data-label="Actions">
          <%= link_to transaction_path(tx), method: :delete,
                       form: { class: "d-inline" },
                       data: { turbo_confirm: "Are you sure you want to delete this transaction?" },
                       class: "btn btn-sm btn-outline-light btn-action py-0 px-2" do %>
            <i class="bi bi-trash fs-6"></i>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</div>
<% end %>
