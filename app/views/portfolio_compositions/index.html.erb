<div class="container py-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div class="d-flex align-items-center">
      <div>
        <h1 class="display-4 mb-0">My Portfolio</h1>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-8">
      <%= render 'shared/panel', locals: {
          title: "Portfolio Chart",
          panel_meta: "",
          divider_top:  false
        } do %>
          <div class="card-body" >
            <div class="chart-placeholder" style="height: 300px;"
                data-controller="portfolio-performance-chart" data-action="resize@window->portfolio-performance-chart#resize"
                data-portfolio-performance-chart-userid-value='"<%= @current_user.id %>"'
                data-portfolio-performance-chart-range-value="1y">
              <div class="d-flex justify-content-center align-items-center h-100 w-100">
                <div class="text-center chart" data-portfolio-performance-chart-target="container" style="position: relative; width: 70vw; height: 300px;">
                  <canvas data-portfolio-performance-chart-target="chart">
                    <p class="text-muted" >Price chart would display here</p>
                  </canvas>

                </div>
              </div>
            </div>
          </div>
      <% end %>





      <%= render 'shared/panel', locals: {
        title: "My Portfolio",
        subtitle: "Your portfolio composition",
        header_actions: [],
        footer: true,
        objects: { title: "coin", objects: @portfolio_compositions },
        footer_actions: [
          { html: -> { link_to "#", class: "btn btn-nav me-2 active" do
              content_tag(:i, "", class: "fa-solid fa-file-pdf")
            end }
          },
          { html: -> { link_to "#", class: "btn btn-nav me-2 active" do
              content_tag(:i, "", class: "fa-solid fa-file-csv")
            end }
          }
        ]
        } do %>

        <div class="panel-body">
          <% if @portfolio_compositions.blank? %>
            <div class="text-center py-5">
              <i class="bi bi-arrow-left-right text-muted" style="font-size: 3rem;"></i>
              <h3 class="mt-3">No Transactions Yet</h3>
              <p class="text-muted">Get started by creating your first transaction</p>
              <%= link_to "#",
                class: "btn btn-highlight",
                data: { bs_toggle: "modal", bs_target: "#newTransactionModal" } do %>
                  <i class="fa-solid fa-plus"></i>
              <% end %>
            </div>
          <% else %>

            <div class="table-responsive">
              <table class="table table-hover align-middle mb-0">
                <thead>
                  <tr>
                    <th>Date</th>
                    <th>Coin</th>
                    <th>Price</th>
                    <th>Total Amount</th>
                    <th>Current Value</th>
                    <th>Amount Invested</th>
                    <th>Unrealised Profit</th>
                    <th>Realised Profit</th>
                    <th>Actions</th>
                  </tr>
                </thead>

                <tbody>

                  <% @portfolio_compositions.order(date: :desc).each do |pc| %>
                    <tr class="datarow m-2">
                      <td><%= pc.date.to_formatted_s(:short) %></td>
                      <td>
                        <%= image_tag pc.coin.logo_url, class: "img-thumbnail rounded-circle me-1", style: "width: 24px; height: 24px;" %>
                        <%= pc.coin.symbol %>
                      </td>
                      <td></td>
                      <td><%= number_to_currency(pc.cumulative_amount, unit: "$") %></td>
                      <td></td>
                      <td><%= number_to_currency(pc.amount_invested, unit: "$") %></td>
                      <td></td>
                      <td></td>
                      <td>
                        <div class="btn-group" role="group">


                        </div>
                      </td>
                    </tr>

                  <% end %>
                <tbody>
                </tbody>
              </table>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>


    <div class="col-lg-4">

      <%= render 'shared/panel', locals: {
          title: "Portfolio Value",
          panel_meta: "",
          divider_top:  false
        } do %>

        <%= @portfolio_total %><br>
        <%= @portfolio_invested %><br>
        <%= @total_pnl %><br>

      <% end %>

      <%= render 'shared/panel', locals: {
          title: "Portfolio Composition",
          panel_meta: "",
          divider_top:  false
        } do %>
          <canvas data-controller="portfolio-composition-chart">
            <p class="text-muted" >Price chart would display here</p>
          </canvas>
      <% end %>





    </div>


</div>
